<launch>
  <arg name="kbd_teleop" default="false"/>
  <arg name="rqt_teleop" default="false"/>
  <arg name="obs_pc" default="true"/>
  <arg name="ped_pc" default="true"/>
  <arg name="pose_initial_x" default="5.0"/>
  <arg name="pose_initial_y" default="5.0"/>
  <arg name="pose_initial_theta" default="0.0"/>

  <!-- robot driving controller -->
  <node name="driving_controller" type="simulate_diff_drive_robot" pkg="pedsim_simulator" output="screen">
    <param name="pose_initial_x" value="$(arg pose_initial_x)"/>
    <param name="pose_initial_y" value="$(arg pose_initial_y)"/>
    <param name="pose_initial_theta" value="$(arg pose_initial_theta)"/>
    <remap from="/cmd_vel" to="/pedbot/control/cmd_vel"/>
  </node>

  <!-- Keyboard robot steering -->
  <node pkg="pedsim_simulator" name="pedsim_keyboard_teleop" type="keyboard_teleop.py" output="screen" if="$(arg kbd_teleop)">
    <remap from="/pedsim_keyboard_teleop/cmd_vel" to="/pedbot/control/cmd_vel"/>
  </node>

  <!-- RQT robot steering -->
  <node pkg="rqt_robot_steering" name="rqt_robot_steering" type="rqt_robot_steering" if="$(arg rqt_teleop)">
    <remap from="/cmd_vel" to="/pedbot/control/cmd_vel"/>
  </node>

  <!-- point cloud -->
  <include file="$(find pedsim_sensors)/launch/obstacle_pcd_sensor.launch" if="$(arg obs_pc)"/>
  <include file="$(find pedsim_sensors)/launch/people_pcd_sensor.launch" if="$(arg ped_pc)"/>
  <!-- pointcloud_to_laserscan -->
  <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pointcloud_to_laserscan">
    <rosparam>
      target_frame: base_footprint
      transform_tolerance: 0.01
      min_height: 0.0
      max_height: 1.0
      
      angle_min: -3.1416
      angle_max: 3.1416
      angle_increment: 0.0087
      scan_time: 0.3333
      range_min: 0.45
      range_max: 4.0
      use_inf: true
      
      #concurrency_level affects number of pc queued for processing and the number of threadsused
      # 0: Detect number of cores
      # 1: Single threaded
      # 2: inf : Parallelism level
      concurrency_level: 1
    </rosparam>
    <remap from="cloud_in" to="/pedsim_obstacle_sensor/point_cloud_local"/>
    <remap from="scan" to="/pedsim_obstacle_sensor/scan"/>
  </node>
</launch>
